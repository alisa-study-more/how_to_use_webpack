// JavaScript Document

$(document).ready(function(){
	commentSet();
	tabChange();
	goLetter();
	lineSet();
});

/* 类别左侧高度 */
function leftHeight(){
	var winH = $(window).height();
	var winW = $(window).width();
	var rightH = $(".rightCon").height();
	var topH = $("header").height() + $(".polyTabs").height();
	$(".category-bd").css({"width":winW/4,"height":winH});
}

/* 切换 */
var isAnimating = false;
function commentSet(){
	$(".polyTabs ul li").on("tap",function(){
		
		var frontIndex = $(".polyTabs ul li.current").index();
		var thisIndex = $(this).index();
		
		if(isAnimating || thisIndex == frontIndex){
			return;
		}
		
		$(".polyTabs ul li").removeClass("current");
		$(".polyTabs ul li").eq($(this).index()).addClass("current");
		
		pageSwitch(frontIndex,thisIndex);
		
		leftHeight();
	});
}

/* 类别 类目切换 */
function tabChange(){
	$(".leftNav .name").on("tap",function(){
		$(".leftNav .name").removeClass("on");
		$(this).addClass("on");
		$(".rightCon > div").removeClass("sh");
		$(".rightCon > div").eq($(this).index()).addClass("sh");
		leftHeight();
	});

}

/* 线条精度 */
function lineSet(){
	if (window.devicePixelRatio && devicePixelRatio >= 2) {
	
	  var testElem = document.createElement('div');
	  testElem.style.border = '.5px solid transparent';
	  document.body.appendChild(testElem);
	  if (testElem.offsetHeight == 1){
		$(".polyTabs,.leftNav .name,.allBrand,.brandList a img,nav.bottomNav").css({"border-width":".5px"});
	  }
	  document.body.removeChild(testElem);
	}
}

function rightLetter(){
	var winH = $(window).height();
	$("ul.tt").css("height",winH - (1.5*100));
}

/* 全部品牌 字母跳转 */
function idGo(){
	var links = document.getElementsByClassName("brand_all_letter");
	for (var i = 0; i < links.length; i ++) {
			links[i].id = i;
	}
}

function goLetter(){
	idGo();
	rightLetter();
	for(var i=65;i<91;i++){
		var a_z;
		$("ul.tt").append("<li class='letterLi'>"+ String.fromCharCode(i) +"</li>");
	}
	$("ul.tt").append("<li class='letterLi'>#</li>");
	
	var winH = $(window).height();
	
	$(".tt li").each(function(){
		$(this).on("touchend",function(){
			scroller($(this).index(), 200);
			event.preventDefault();    //  阻止事件冒泡，将tap改为touchend，并阻止touchend的默认行为event.preventDefault();
		})
	})
}

// 转换为数字 
function intval(v) { 
    v = parseInt(v); 
    return isNaN(v) ? 0 : v; 
}
// 获取元素信息 
function getPos(e) { 
    var l = 0; 
    var t  = 0; 
    var w = intval(e.style.width);
    var h = intval(e.style.height);
    var wb = e.offsetWidth;
    var hb = e.offsetHeight;
    while (e.offsetParent){
        l += e.offsetLeft + (e.currentStyle?intval(e.currentStyle.borderLeftWidth):0);
        t += e.offsetTop  + (e.currentStyle?intval(e.currentStyle.borderTopWidth):0);
        e = e.offsetParent;
    }
    l += e.offsetLeft + (e.currentStyle?intval(e.currentStyle.borderLeftWidth):0);
    t  += e.offsetTop  + (e.currentStyle?intval(e.currentStyle.borderTopWidth):0);
    return {x:l, y:t, w:w, h:h, wb:wb, hb:hb};
}
// 获取滚动条信息 
function getScroll(){
    var t, l, w, h;

    if (document.documentElement && document.documentElement.scrollTop) {
        t = document.documentElement.scrollTop;
        l = document.documentElement.scrollLeft;
        w = document.documentElement.scrollWidth;
        h = document.documentElement.scrollHeight;
    } else if (document.body) {
        t = document.body.scrollTop;
        l = document.body.scrollLeft;
        w = document.body.scrollWidth;
        h = document.body.scrollHeight;
    }
    return { t: t, l: l, w: w, h: h };
}

// 锚点(Anchor)间平滑跳转 
function scroller(el, duration) { 
    if(typeof el != 'object'){
		el = document.getElementById(el);
	} 

    if(!el) return; 

    var z = this; 
    z.el = el; 
    z.p = getPos(el); 
    z.s = getScroll(); 
    z.clear = function(){window.clearInterval(z.timer);z.timer=null}; 
    z.t=(new Date).getTime(); 

    z.step = function(){
        var t = (new Date).getTime(); 
        var p = (t - z.t) / duration; 
        if (t >= duration + z.t) { 
            z.clear(); 
            window.setTimeout(function(){z.scroll(z.p.y, z.p.x)},13); 
        } else { 
            st = ((-Math.cos(p*Math.PI)/2) + 0.5) * (z.p.y-z.s.t) + z.s.t; 
            sl = ((-Math.cos(p*Math.PI)/2) + 0.5) * (z.p.x-z.s.l) + z.s.l; 
            z.scroll(st, sl); 
        } 
    };
    z.scroll = function (t, l){window.scrollTo(l, t)}; 
    z.timer = window.setInterval(function(){z.step();},13); 
} 

function pageSwitch(nowP,activeP){
	
	var direction;

	if (nowP < activeP) { 
		direction = 0;
	}else{
		direction = 1;
	};

	var pageIndex = nowP;
	var lastPage = ".page-"+activeP;

	var nowPage = ".page-"+pageIndex;

	switch(direction) {
		case 0:
			outClass = 'pt-page-moveToLeft';
			inClass = 'pt-page-moveFromRight';
			break;
		case 1:
			outClass = 'pt-page-moveToRight';
			inClass = 'pt-page-moveFromLeft';
			break;
	}
	isAnimating = true;
	$(lastPage).removeClass("hide");
	
	$(nowPage).addClass(outClass);
	$(lastPage).addClass(inClass);
	
	setTimeout(function(){		
		$(nowPage).removeClass('page-current');
		$(nowPage).removeClass(outClass);
		$(nowPage).addClass("hide");
		
		$(lastPage).addClass('page-current');
		$(lastPage).removeClass(inClass);

		isAnimating = false;
	},600);

}