// JavaScript Document

$(document).ready(function(){
	navSet();
	lineSet();
	slideSet();
});

/* 导航设置 */
function navSet() {
    var liSum = 0;
    var navLi = $(".topNav li");
    var windowW = $(window).width();
    liSum = (windowW/4.5) * navLi.length;
    if(liSum > windowW){
        $(".topNav ul").css({
            "width": liSum + "px"
        });
        $(".topNav li").css({
            "width": (100 / navLi.length) + "%"
        });
    }else{
        $(".topNav li").css({
            "width": (100 / navLi.length) + "%"
        });
    }
	
	navTap();
}

/* 移动幻灯事件 */
function slideSet(){
	TouchSlide({ 
		slideCell:"#focus_0",
		titCell:".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
		mainCell:".bd ul", 
		effect:"leftLoop", 
		autoPlay:true,//自动播放
		autoPage:true //自动分页
	});
}

/* 线条精度 */
function lineSet(){
	if (window.devicePixelRatio && devicePixelRatio >= 2) {
	
	  var testElem = document.createElement('div');
	  testElem.style.border = '.5px solid transparent';
	  document.body.appendChild(testElem);
	  if (testElem.offsetHeight == 1){
		$(".b-t,.b-b,.indexSingle a:nth-child(2),.title,nav.bottomNav").css({"border-width":".5px"});
	  }
	  document.body.removeChild(testElem);
	}
}

var isAnimating = false;
function navTap(){
	
	$(".topNav li a").on('tap',function(){
		//导航显示切换
		var frontIndex = $("nav.topNav ul li a.nav_hover").parent().index();
		var thisIndex = $(this).parent().index();
		
		if(isAnimating || thisIndex == frontIndex){
			return;
		}
		
		var navLi = $(".topNav li").width();
		var nowLeft = $(".topNav").scrollLeft();
		if($(this).parent().index() > 2){
			$(".topNav").scrollLeft(nowLeft + navLi);
		}else{
			$(".topNav").scrollLeft(nowLeft - navLi);
		}
		
		$(".topNav li a").removeClass();
		$(".topNav li").eq(thisIndex).find("a").addClass("nav_hover");
		

		pageSwitch(frontIndex,thisIndex);
	})
}

function pageSwitch(nowP,activeP){
	
	var direction;

	if (nowP < activeP) { 
		direction = 0;
	}else{
		direction = 1;
	};

	var pageIndex = nowP;
	var lastPage = ".page-"+activeP;

	var nowPage = ".page-"+pageIndex;

	switch(direction) {
		case 0:
			outClass = 'pt-page-moveToLeft';
			inClass = 'pt-page-moveFromRight';
			break;
		case 1:
			outClass = 'pt-page-moveToRight';
			inClass = 'pt-page-moveFromLeft';
			break;
	}
	isAnimating = true;
	$(lastPage).removeClass("hide");
	
	$(nowPage).addClass(outClass);
	$(lastPage).addClass(inClass);
	
	setTimeout(function(){		
		$(nowPage).removeClass('page-current');
		$(nowPage).removeClass(outClass);
		$(nowPage).addClass("hide");
		
		$(lastPage).addClass('page-current');
		$(lastPage).removeClass(inClass);

		isAnimating = false;
	},600);

}